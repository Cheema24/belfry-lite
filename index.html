<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>Belfry Lite v0.1 Prime ‚Äî Planes + Refresh + Hover Info</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<style>
:root{
  --bg:#07070a; --panel:#0f1114; --muted:#9aa0a6; --white:#ffffff;
  --blue:#3aa0f2; --yellow:#ffd15c; --red:#ff4d4d; --purple:#b46eff;
}
html,body{height:100%;margin:0;background:var(--bg);color:var(--white);font-family:Inter,Arial,Helvetica,sans-serif}
#app{display:none;height:100%;width:100%}
header{height:56px;display:flex;align-items:center;padding:8px 14px;gap:12px;background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent);border-bottom:1px solid rgba(255,255,255,0.03)}
h1{margin:0;font-size:16px}
.header-right{margin-left:auto;display:flex;align-items:center;gap:8px}
.pill{padding:6px 10px;border-radius:8px;background:var(--panel);border:1px solid rgba(255,255,255,0.03);color:var(--muted)}
#map{position:absolute;top:56px;left:0;right:0;bottom:0;}
#sidePanel{position:absolute;top:72px;right:12px;width:360px;max-height:calc(100% - 96px);padding:12px;background:var(--panel);border-radius:10px;box-shadow:0 10px 30px rgba(0,0,0,0.6);transform:translateX(380px);opacity:0;transition:transform .32s, opacity .28s;overflow:auto;z-index:1001;pointer-events:none;}
#sidePanel.open{transform:translateX(0);opacity:1;pointer-events:auto}
#dimOverlay{position:absolute;inset:56px 0 0 0;background:rgba(0,0,0,0.35);z-index:1000;opacity:0;pointer-events:none;transition:opacity .28s;}
#dimOverlay.visible{opacity:1;pointer-events:auto}
.control-row{display:flex;gap:8px;align-items:center;margin-bottom:10px;flex-wrap:wrap}
input[type="text"], select{padding:8px 10px;border-radius:6px;border:1px solid rgba(255,255,255,0.06);background:#0d0f12;color:var(--white);outline:none;width:100%}
button.primary{padding:8px 10px;border-radius:6px;border:none;cursor:pointer;background:var(--blue);color:#012028;font-weight:600}
.muted{color:var(--muted);font-size:13px}
.stats{margin-top:8px;padding:10px;border-radius:8px;background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent);border:1px solid rgba(255,255,255,0.02)}
.stat-line{display:flex;justify-content:space-between;margin-bottom:6px;font-size:13px;color:var(--muted)}
.legend{position:absolute;left:12px;bottom:12px;background:rgba(0,0,0,0.5);padding:8px 10px;border-radius:8px;font-size:13px;color:var(--white);border:1px solid rgba(255,255,255,0.04);z-index:900}
.legend-item{display:flex;gap:8px;align-items:center;margin-bottom:6px}
.legend-dot{width:12px;height:12px;border-radius:50%;display:inline-block}
.gear{width:36px;height:36px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);display:flex;align-items:center;justify-content:center;background:var(--panel);cursor:pointer;}
.gear:hover{box-shadow:0 6px 18px rgba(0,0,0,0.5)}
</style>
</head>
<body>
<div id="app">
<header>
<h1>Belfry Lite v0.1 Prime</h1>
<div class="header-right">
<div class="pill" id="refreshPill">üõ∞Ô∏è <span id="refreshText">Idle</span></div>
<div class="pill muted">Last: <span id="lastText">‚Äî</span></div>
<div class="gear" id="controlsToggle">‚öôÔ∏è</div>
</div>
</header>
<div id="map"></div>
<div id="dimOverlay"></div>
<div id="sidePanel">
<div class="control-row">
<label><input type="checkbox" id="locationToggle"> Search by location</label>
</div>
<div id="locationControls" style="display:none;flex-direction:column;gap:8px">
<input list="continentList" id="continentInput" placeholder="Continent"><datalist id="continentList"></datalist>
<input list="countryList" id="countryInput" placeholder="Country" disabled><datalist id="countryList"></datalist>
<input list="cityList" id="cityInput" placeholder="City" disabled><datalist id="cityList"></datalist>
</div>
<div class="control-row" style="margin-top:6px;">
<input type="text" id="flightSearchInput" placeholder="Search flight by destination or type">
</div>
<div class="control-row">
<label>Flight Type
<select id="typeDropdown">
<option value="all">All</option>
<option value="private">Private</option>
<option value="commercial">Commercial</option>
<option value="military">Military</option>
<option value="test">Test</option>
</select>
</label>
<button id="toggleTestBtn" class="primary">Toggle Test Flights</button>
</div>
<div class="control-row">
<label>Time filter
<select id="timeSelect">
<option value="all">All</option>
<option value="15">Last 15 min</option>
<option value="30">Last 30 min</option>
<option value="60">Last 60 min</option>
</select>
</label>
<button id="mapThemeBtn" class="primary">Toggle Map Theme</button>
<button id="centerBtn" class="primary">Center Map</button>
</div>
<div class="stats">
<div class="stat-line"><div>Flights visible</div><div id="statCount">0</div></div>
<div class="stat-line"><div>Commercial</div><div id="statCommercial">0</div></div>
<div class="stat-line"><div>Private</div><div id="statPrivate">0</div></div>
<div class="stat-line"><div>Military</div><div id="statMilitary">0</div></div>
<div class="stat-line"><div>Test</div><div id="statTest">0</div></div>
</div>
</div>
<div class="legend" id="legend">
<div style="font-weight:600;margin-bottom:6px">Legend</div>
<div class="legend-item"><span class="legend-dot" style="background:var(--blue)"></span> Commercial</div>
<div class="legend-item"><span class="legend-dot" style="background:var(--yellow)"></span> Private</div>
<div class="legend-item"><span class="legend-dot" style="background:var(--red)"></span> Military</div>
<div class="legend-item"><span class="legend-dot" style="background:var(--purple)"></span> Test</div>
</div>
</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
document.addEventListener('DOMContentLoaded',()=>{

// --- PASSWORD ---
const PASSWORD="belfryprime"; let attempts=0;
function auth(){
  const p=prompt("Enter password for Belfry Lite v0.1:");
  if(p===null){document.body.innerHTML="<h2 style='color:#faa;text-align:center;margin-top:50px'>Authentication cancelled</h2>";throw new Error("auth cancelled");}
  if(p!==PASSWORD){attempts++;alert("Incorrect password.");if(attempts>=3){document.body.innerHTML="<h2 style='color:red;text-align:center;margin-top:50px'>Access Denied</h2>";throw new Error("access denied");}return auth();}
  document.getElementById('app').style.display='block';document.getElementById('lastText').textContent=new Date().toLocaleString();
}
auth();

// --- MAP ---
const darkTiles=L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png',{subdomains:'abcd',maxZoom:19});
const lightTiles=L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19});
const map=L.map('map',{preferCanvas:true}).setView([20,0],2); darkTiles.addTo(map); let darkMode=true;
document.getElementById('mapThemeBtn').addEventListener('click',()=>{ if(darkMode){map.removeLayer(darkTiles); lightTiles.addTo(map); darkMode=false;}else{map.removeLayer(lightTiles); darkTiles.addTo(map); darkMode=true;}});
document.getElementById('centerBtn').addEventListener('click',()=>{map.setView([20,0],2);});

// --- PANEL ---
const controlsToggle=document.getElementById('controlsToggle');
const sidePanel=document.getElementById('sidePanel');
const dimOverlay=document.getElementById('dimOverlay');
function openPanel(){ sidePanel.classList.add('open'); dimOverlay.classList.add('visible'); setTimeout(()=>map.invalidateSize(),320);}
function closePanel(){ sidePanel.classList.remove('open'); dimOverlay.classList.remove('visible'); setTimeout(()=>map.invalidateSize(),320);}
controlsToggle.addEventListener('mouseenter',openPanel);
sidePanel.addEventListener('mouseleave',closePanel);
dimOverlay.addEventListener('click',closePanel);

// --- DUMMY FLIGHTS ---
let flights=[]; let testFlightsVisible=true;
function generateDummyFlights(){
  const now=Date.now();
  return [
    {id:1,type:'commercial',lat:51.5,lng:-0.1,dest:'London',origin:'New York',alt:35000,speed:480,timestamp:now-600000},
    {id:2,type:'private',lat:40.7,lng:-74,dest:'New York',origin:'Boston',alt:12000,speed:350,timestamp:now-1200000},
    {id:3,type:'military',lat:33.7,lng:73.1,dest:'Islamabad',origin:'Karachi',alt:40000,speed:520,timestamp:now-900000},
    {id:4,type:'test',lat:48.8,lng:2.3,dest:'Paris',origin:'London',alt:30000,speed:450,timestamp:now-300000},
    {id:5,type:'commercial',lat:-33.9,lng:151.2,dest:'Sydney',origin:'Melbourne',alt:36000,speed:470,timestamp:now-1800000},
    {id:6,type:'private',lat:35.7,lng:139.7,dest:'Tokyo',origin:'Osaka',alt:15000,speed:340,timestamp:now-600000},
    {id:7,type:'military',lat:55.7,lng:37.6,dest:'Moscow',origin:'St. Petersburg',alt:38000,speed:500,timestamp:now-1500000},
    {id:8,type:'test',lat:19.4,lng:-99.1,dest:'Mexico City',origin:'Cancun',alt:32000,speed:430,timestamp:now-400000},
    {id:9,type:'commercial',lat:52.5,lng:13.4,dest:'Berlin',origin:'Paris',alt:37000,speed:460,timestamp:now-500000},
    {id:10,type:'private',lat:1.3,lng:103.8,dest:'Singapore',origin:'Jakarta',alt:14000,speed:330,timestamp:now-800000}
  ];
}
flights=generateDummyFlights();
let flightMarkers=[], flightLines=[], flightPlanes=[];

// --- PLANE ICONS ---
const planeIcons = {
  commercial:L.icon({iconUrl:'https://cdn-icons-png.flaticon.com/512/684/684908.png',iconSize:[20,20],iconAnchor:[10,10]}),
  private:L.icon({iconUrl:'https://cdn-icons-png.flaticon.com/512/684/684909.png',iconSize:[20,20],iconAnchor:[10,10]}),
  military:L.icon({iconUrl:'https://cdn-icons-png.flaticon.com/512/684/684910.png',iconSize:[20,20],iconAnchor:[10,10]}),
  test:L.icon({iconUrl:'https://cdn-icons-png.flaticon.com/512/684/684911.png',iconSize:[20,20],iconAnchor:[10,10]})
};

// --- FLIGHTS RENDER + ANIMATION ---
function addFlightAnimations(flightsToRender){
  flightLines.forEach(l=>map.removeLayer(l)); flightPlanes.forEach(p=>map.removeLayer(p));
  flightLines=[]; flightPlanes=[];
  flightsToRender.forEach(f=>{
    if(f.type==='test' && !testFlightsVisible) return;
    let color=f.type==='commercial'? '--blue': f.type==='private'? '--yellow': f.type==='military'? '--red':'--purple';
    let col=getComputedStyle(document.documentElement).getPropertyValue(color);
    let latlngs=[[f.lat,f.lng],[f.lat+Math.random()*2-1,f.lng+Math.random()*2-1]];
    let poly=L.polyline(latlngs,{color:col,weight:2,opacity:0.6}).addTo(map); flightLines.push(poly);
    let plane=L.marker(latlngs[0],{icon:planeIcons[f.type]}).addTo(map); flightPlanes.push(plane);
    let t=0; function animate(){ t+=0.005; if(t>1) t=0; let lat=latlngs[0][0]+(latlngs[1][0]-latlngs[0][0])*t; let lng=latlngs[0][1]+(latlngs[1][1]-latlngs[0][1])*t; plane.setLatLng([lat,lng]); requestAnimationFrame(animate);}
    animate();
  });
}

function renderFlights(){
  flightMarkers.forEach(m=>map.removeLayer(m)); flightMarkers=[];
  const filterType=document.getElementById('typeDropdown').value;
  const searchQuery=document.getElementById('flightSearchInput').value.toLowerCase();
  const timeFilter=document.getElementById('timeSelect').value;
  const now=Date.now();
  let flightsToRender=[];
  let count={commercial:0,private:0,military:0,test:0};

  flights.forEach(f=>{
    if(f.type==='test' && !testFlightsVisible) return;
    if(filterType!=='all' && f.type!==filterType) return;
    if(searchQuery && !(f.dest.toLowerCase().includes(searchQuery) || f.type.toLowerCase().includes(searchQuery))) return;
    if(timeFilter!=='all' && (now-f.timestamp)/60000>parseInt(timeFilter)) return;

    let m=L.marker([f.lat,f.lng],{icon:planeIcons[f.type]}).addTo(map);
    m.bindPopup(`<b>${f.type.toUpperCase()} flight</b><br>From: ${f.origin}<br>To: ${f.dest}<br>Altitude: ${f.alt} ft<br>Speed: ${f.speed} kt`);
    flightMarkers.push(m); flightsToRender.push(f);
    count[f.type]++;
  });
  addFlightAnimations(flightsToRender);

  document.getElementById('statCount').textContent=flightMarkers.length;
  document.getElementById('statCommercial').textContent=count['commercial']||0;
  document.getElementById('statPrivate').textContent=count['private']||0;
  document.getElementById('statMilitary').textContent=count['military']||0;
  document.getElementById('statTest').textContent=count['test']||0;
  document.getElementById('refreshText').textContent='Refreshed';
  document.getElementById('lastText').textContent=new Date().toLocaleString();
}

// --- CONTROLS ---
document.getElementById('toggleTestBtn').addEventListener('click',()=>{ testFlightsVisible=!testFlightsVisible; renderFlights(); });
document.getElementById('typeDropdown').addEventListener('change',renderFlights);
document.getElementById('flightSearchInput').addEventListener('input',renderFlights);
document.getElementById('timeSelect').addEventListener('change',renderFlights);

// --- LOCATION CONTROLS ---
const locationToggle=document.getElementById('locationToggle');
const locationControls=document.getElementById('locationControls');
locationToggle.addEventListener('change',()=>{ locationControls.style.display=locationToggle.checked?'flex':'none'; });
const continents=['Africa','Europe','Asia','North America','South America','Oceania'];
const countries={'Europe':['UK','France','Germany'],'Asia':['Pakistan','Japan','China'],'North America':['USA','Canada','Mexico'],'Oceania':['Australia','New Zealand'],'Africa':['Egypt','Nigeria','South Africa'],'South America':['Brazil','Argentina','Chile']};
const cities={'UK':['London','Manchester'],'France':['Paris','Lyon'],'Germany':['Berlin','Munich'],'Pakistan':['Islamabad','Karachi'],'Japan':['Tokyo','Osaka'],'China':['Beijing','Shanghai'],'USA':['New York','Los Angeles'],'Canada':['Toronto','Vancouver'],'Mexico':['Mexico City','Cancun'],'Australia':['Sydney','Melbourne'],'New Zealand':['Auckland','Wellington'],'Egypt':['Cairo'],'Nigeria':['Lagos'],'South Africa':['Cape Town'],'Brazil':['Sao Paulo'],'Argentina':['Buenos Aires'],'Chile':['Santiago']};

const continentInput=document.getElementById('continentInput');
const countryInput=document.getElementById('countryInput');
const cityInput=document.getElementById('cityInput');
continentInput.addEventListener('input',()=>{
  countryInput.disabled=false; countryInput.value=''; cityInput.value=''; cityInput.disabled=true;
  let list=countries[continentInput.value]||[];
  const dl=document.getElementById('countryList'); dl.innerHTML=''; list.forEach(c=>{let o=document.createElement('option'); o.value=c; dl.appendChild(o);});
});
countryInput.addEventListener('input',()=>{
  cityInput.disabled=false; cityInput.value='';
  let list=cities[countryInput.value]||[];
  const dl=document.getElementById('cityList'); dl.innerHTML=''; list.forEach(c=>{let o=document.createElement('option'); o.value=c; dl.appendChild(o);});
});

// --- INITIAL RENDER ---
renderFlights();

});
</script>
</body>
</html>
